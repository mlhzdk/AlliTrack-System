<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Preferences - AlliTrack</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="../css/sidebar-header.css" />
    <link rel="stylesheet" href="../css/preferences.css" />
    <script src="../js/preference-manager.js"></script>
    <script src="../js/user-data-manager.js"></script>
</head>

<body>
    <div class="app">
        <div class="shell">
            <!-- Sidebar -->
            <aside class="sidebar" role="navigation" aria-label="Main Sidebar">
                <div class="brand">
                    <div class="logo">
                        <img src="../pictures/AlliTrack Logo.png" alt="AlliTrack Logo" class="logo-img"
                            style="width: 32px; height: 32px;">
                    </div>
                    <div>
                        <div class="title">AlliTrack</div>
                        <div class="subtitle" data-section="userDashboard">User Dashboard</div>
                    </div>
                </div>
                <nav class="nav">
                    <a href="../pages/index-user.html" data-section="dashboard">
                        <i class="fas fa-chart-line"></i> <span data-section="dashboard">Dashboard</span>
                    </a>

                    <div class="nav-section" data-section="support">Support</div>
                    <a href="../pages/my-tickets.html" data-section="tickets">
                        <i class="fas fa-ticket-alt"></i> <span data-section="myTickets">My Tickets</span>
                    </a>
                    <a href="../pages/notifications.html" data-section="notifications">
                        <i class="fas fa-bell"></i> <span data-section="notifications">Notifications</span>
                    </a>
                    <a href="../pages/submit-ticket.html" data-section="submit-ticket">
                        <i class="fas fa-plus-circle"></i> <span data-section="submitTicket">Submit a Ticket</span>
                    </a>

                    <div class="nav-section" data-section="management">Management</div>
                    <a href="../pages/preferences.html" class="active" data-section="preferences">
                        <i class="fas fa-sliders-h"></i> <span data-section="preferences">Preferences</span>
                    </a>
                    <a href="../pages/profile-settings.html" data-section="profile-settings">
                        <i class="fas fa-user-cog"></i> <span data-section="profileSettings">Profile Settings</span>
                    </a>
                    <a href="../pages/announcements.html" data-section="announcements">
                        <i class="fas fa-bullhorn"></i> <span data-section="announcements">Announcements</span>
                    </a>

                    <div class="nav-section" data-section="system">System</div>
                    <a href="../pages/account-security.html" data-section="account-security">
                        <i class="fas fa-shield-alt"></i> <span data-section="accountSecurity">Account Security</span>
                    </a>
                    <a href="../pages/system-information.html" data-section="system-information">
                        <i class="fas fa-info-circle"></i> <span data-section="systemInformation">System
                            Information</span>
                    </a>
                </nav>
                <div class="sidebar-footer">
                    <div class="version">v1.2.0</div>
                    <div>Business Alliance Inc.</div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main">
                <!-- Header -->
                <header class="header">
                    <div class="search" role="search" aria-label="Search Tickets">
                        <i class="fas fa-search" style="opacity:.6"></i>
                        <input id="q" placeholder="Search tickets, users, IDs..." data-input="searchPlaceholder"
                            aria-label="Search tickets, users, IDs" />
                    </div>
                    <div class="header-actions">
                        <div style="text-align:right">
                            <div id="userName" style="font-weight:700">User</div>
                            <div id="userEmail" style="font-size:.82rem;color:var(--muted)">user@example.com</div>
                        </div>
                        <div class="account" id="accountBtn" aria-haspopup="true" aria-expanded="false">
                            <div id="userAvatar" class="avatar">U</div>
                            <i class="fas fa-chevron-down" style="opacity:.85"></i>
                        </div>
                        <div class="account-menu" id="accountMenu">
                            <div class="arrow"></div>
                            <a href="../pages/profile-settings.html" data-section="profile">Profile</a>
                            <a href="../pages/preferences.html" data-section="settings">Settings</a>
                            <a href="#" id="logoutBtn" data-section="logout">Logout</a>
                        </div>
                    </div>
                </header>

                <!-- Preferences Content -->
                <div class="content">
                    <div class="preferences-content">
                        <!-- Header with Container -->
                        <div class="preferences-header-container">
                            <div class="preferences-header">
                                <h1><i class="fas fa-sliders-h"></i> <span data-section="pageHeader">Preferences</span>
                                </h1>
                            </div>
                        </div>

                        <!-- Success Message -->
                        <div class="success-message" id="successMessage">
                            <div class="success-icon">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="success-text" data-section="successMessage">Preferences saved successfully!
                            </div>
                        </div>

                        <!-- Preferences Form -->
                        <form class="preferences-container" id="preferencesForm">
                            <!-- Notification Settings -->
                            <div class="preferences-section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-bell"></i>
                                    </div>
                                    <div>
                                        <h2 class="section-title" data-section="notificationSettings">Notification
                                            Settings</h2>
                                        <p class="section-description" data-section="notificationDescription">Manage how
                                            and when you receive notifications</p>
                                    </div>
                                </div>

                                <div class="settings-grid" id="notificationSettingsGrid">
                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <div class="setting-title" data-section="emailNotifications">Email
                                                Notifications</div>
                                            <div class="setting-description" data-section="emailDescription">Receive
                                                email alerts for ticket updates and
                                                system announcements</div>
                                        </div>
                                        <div class="setting-control">
                                            <label class="toggle">
                                                <input type="checkbox" id="emailNotifications" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <div class="setting-title" data-section="pushNotifications">Push
                                                Notifications</div>
                                            <div class="setting-description" data-section="pushDescription">Show browser
                                                notifications for urgent
                                                updates</div>
                                        </div>
                                        <div class="setting-control">
                                            <label class="toggle">
                                                <input type="checkbox" id="pushNotifications" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <div class="setting-title" data-section="ticketUpdates">Ticket Updates</div>
                                            <div class="setting-description" data-section="ticketDescription">Notify me
                                                when my tickets are updated or
                                                resolved</div>
                                        </div>
                                        <div class="setting-control">
                                            <label class="toggle">
                                                <input type="checkbox" id="ticketUpdates" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <div class="setting-title" data-section="announcementNotifications">New
                                                Announcements</div>
                                            <div class="setting-description" data-section="announcementDescription">
                                                Notify me about new system announcements
                                                and features</div>
                                        </div>
                                        <div class="setting-control">
                                            <label class="toggle">
                                                <input type="checkbox" id="announcementNotifications" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <div class="setting-title" data-section="weeklyDigest">Weekly Digest</div>
                                            <div class="setting-description" data-section="weeklyDescription">Send
                                                weekly summary of all ticket
                                                activities</div>
                                        </div>
                                        <div class="setting-control">
                                            <label class="toggle">
                                                <input type="checkbox" id="weeklyDigest">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Form Actions -->
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" id="resetBtn">
                                        <i class="fas fa-undo"></i> <span data-section="resetDefaults">Reset to
                                            Defaults</span>
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> <span data-section="savePreferences">Save
                                            Preferences</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Language Settings -->
                            <div class="preferences-section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-language"></i>
                                    </div>
                                    <div>
                                        <h2 class="section-title" data-section="languageSettings">Language Settings</h2>
                                        <p class="section-description" data-section="languageDescription">Set your
                                            preferred language for the entire
                                            dashboard</p>
                                    </div>
                                </div>

                                <div class="settings-grid">
                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <div class="setting-title" data-section="dashboardLanguage">Dashboard
                                                Language</div>
                                            <div class="setting-description" data-section="languageDropdown">This will
                                                change the language across all
                                                pages of your dashboard</div>
                                        </div>
                                        <div class="setting-control">
                                            <select class="select-control" id="language">
                                                <option value="en">English</option>
                                                <option value="fil">Filipino</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Theme Settings -->
                            <div class="preferences-section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-palette"></i>
                                    </div>
                                    <div>
                                        <h2 class="section-title" data-section="themeSettings">Theme Settings</h2>
                                        <p class="section-description" data-section="themeDescription">Customize your
                                            dashboard appearance</p>
                                    </div>
                                </div>

                                <div class="settings-grid">
                                    <div class="setting-item">
                                        <div class="setting-info">
                                            <div class="setting-title" data-section="themeMode">Theme Mode</div>
                                            <div class="setting-description" data-section="themeModeDescription">Switch
                                                between light and dark theme</div>
                                        </div>
                                        <div class="setting-control">
                                            <div class="theme-options">
                                                <button type="button" class="theme-option active" data-theme="auto">
                                                    <i class="fas fa-desktop"></i> <span data-section="auto">Auto</span>
                                                </button>
                                                <button type="button" class="theme-option" data-theme="light">
                                                    <i class="fas fa-sun"></i> <span data-section="light">Light</span>
                                                </button>
                                                <button type="button" class="theme-option" data-theme="dark">
                                                    <i class="fas fa-moon"></i> <span data-section="dark">Dark</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="site-footer">
                    <div>&copy; 2025 Business Alliance Inc.</div>
                    <div data-section="footerText">Dashboard Template</div>
                </footer>
            </main>
        </div>
    </div>

    <script>
        // Initialize the page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Preferences page loading...');

            // Initialize User Data Manager FIRST
            if (window.userDataManager) {
                console.log('User Data Manager found, initializing user display...');
                window.userDataManager.initializeUserDisplay();

                // Check what user data is available
                const userData = window.userDataManager.getUserData();
                console.log('User Data from manager:', userData);
            } else {
                console.error('User Data Manager NOT FOUND! Check if user-data-manager.js is loaded.');
            }

            // Initialize Preferences Manager
            if (window.preferencesManager) {
                console.log('Initializing Preferences Manager for preferences page...');

                // Initialize the manager - it will handle everything
                window.preferencesManager.initialize();

                // Apply theme immediately when page loads
                window.preferencesManager.applyTheme();

                // Apply language immediately
                window.preferencesManager.applyLanguage();
            } else {
                console.error('Preferences Manager not found! Check script path.');
            }

            // Setup event listeners for user data changes
            document.addEventListener('userDataChanged', function (e) {
                console.log('User data changed event received in preferences:', e.detail);
                // Update display if needed
                if (window.userDataManager) {
                    window.userDataManager.updateHeaderAvatar();
                    window.userDataManager.updateUserInfo();
                }
            });

            // Setup reset button
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    if (window.preferencesManager) {
                        window.preferencesManager.resetPreferences();
                    }
                });
            }

            // Setup logout functionality
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Clear user data from localStorage
                    localStorage.removeItem('userData');
                    localStorage.removeItem('userProfile');

                    // Clear preferences
                    localStorage.removeItem('dashboardLanguage');
                    localStorage.removeItem('preferredTheme');
                    localStorage.removeItem('notificationSettings');

                    // Redirect to login page
                    window.location.href = '../../landing page/pages/index.html';
                });
            }

            console.log('Preferences page fully loaded');
        });
    </script>
</body>

</html>