<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title data-translate="dashboard_page_title">Admin Dashboard - AlliTrack</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="../css/header-sidebar.css" />
    <link rel="stylesheet" href="../css/admin.css" />
    <script src="../js/preference-manager.js"></script>
    <script src="../js/admin-data-manager.js"></script>
</head>

<body>
    <!-- Mobile Warning Message -->
    <div class="mobile-warning" style="display: none;">
        <div class="icon">ðŸ“±</div>
        <h1>Admin Dashboard Not Available on Mobile</h1>
        <p>The Admin Dashboard is designed for use on larger screens (laptops, tablets, or desktop computers).
            Please access this feature from a device with a screen width of 768 pixels or larger.</p>
        <p>For mobile access, please use the regular user interface.</p>
        <a href="../../landing page/pages/index.html" class="mobile-btn">Go to Home Page</a>
    </div>

    <!-- Main Dashboard Content -->
    <div class="app" id="dashboardContent">
        <div class="shell">
            <!-- Sidebar -->
            <aside class="sidebar" role="navigation" aria-label="Main Sidebar">
                <div class="brand">
                    <div class="logo">
                        <img src="../pictures/AlliTrack Logo.png" alt="AlliTrack Logo" class="logo-img"
                            style="width: 32px; height: 32px;">
                    </div>
                    <div>
                        <div class="title">AlliTrack</div>
                        <div class="subtitle" data-translate="admin_dashboard">Admin Dashboard</div>
                    </div>
                </div>
                <nav class="nav">
                    <a href="../pages/index-admin.html" class="active" data-section="dashboard">
                        <i class="fas fa-chart-line"></i> <span data-translate="dashboard">Dashboard</span>
                    </a>

                    <div class="nav-section" data-translate="ticket_management">Ticket Management</div>
                    <a href="../pages/admin-tickets.html" data-section="tickets">
                        <i class="fas fa-ticket-alt"></i> <span data-translate="all_tickets">All Tickets</span>
                    </a>
                    <a href="../pages/ticket-queue.html" data-section="ticket-queue">
                        <i class="fas fa-list-ol"></i> <span data-translate="ticket_queue">Ticket Queue</span>
                    </a>
                    <a href="../pages/escalated-tickets.html" data-section="escalated-tickets">
                        <i class="fas fa-exclamation-triangle"></i> <span data-translate="escalated_tickets">Escalated
                            Tickets</span>
                    </a>

                    <div class="nav-section" data-translate="user_management">User Management</div>
                    <a href="../pages/users.html" data-section="users">
                        <i class="fas fa-users"></i> <span data-translate="users">Users</span>
                    </a>
                    <a href="../pages/agents.html" data-section="agents">
                        <i class="fas fa-headset"></i> <span data-translate="support_agents">Support Agents</span>
                    </a>
                    <a href="../pages/roles-permissions.html" data-section="roles-permissions">
                        <i class="fas fa-user-shield"></i> <span data-translate="roles_permissions">Roles &
                            Permissions</span>
                    </a>

                    <div class="nav-section" data-translate="analytics">Analytics</div>
                    <a href="../pages/reports.html" data-section="reports">
                        <i class="fas fa-chart-bar"></i> <span data-translate="reports">Reports</span>
                    </a>
                    <a href="../pages/performance.html" data-section="performance">
                        <i class="fas fa-tachometer-alt"></i> <span data-translate="performance">Performance</span>
                    </a>
                    <a href="../pages/insights.html" data-section="insights">
                        <i class="fas fa-chart-pie"></i> <span data-translate="insights">Insights</span>
                    </a>

                    <div class="nav-section" data-translate="system_admin">System Admin</div>
                    <a href="../pages/system-settings.html" data-section="system-settings">
                        <i class="fas fa-cogs"></i> <span data-translate="system_settings">System Settings</span>
                    </a>
                    <a href="../pages/announcements-admin.html" data-section="announcements">
                        <i class="fas fa-bullhorn"></i> <span data-translate="announcements">Announcements</span>
                    </a>
                    <a href="../pages/audit-log.html" data-section="audit-log">
                        <i class="fas fa-clipboard-list"></i> <span data-translate="audit_log">Audit Log</span>
                    </a>
                </nav>
                <div class="sidebar-footer">
                    <div class="version">v1.2.0</div>
                    <div>Business Alliance Inc.</div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main">
                <!-- Header -->
                <header class="header">
                    <div class="search" role="search" aria-label="Search Tickets">
                        <i class="fas fa-search" style="opacity:.6"></i>
                        <input id="q" placeholder="Search tickets, users, IDs..."
                            data-translate-placeholder="search_tickets" aria-label="Search tickets, users, IDs" />
                    </div>
                    <div class="header-actions">
                        <div style="text-align:right">
                            <div style="font-weight:700" id="userNameDisplay">Admin User</div>
                            <div style="font-size:.82rem;color:var(--muted)" id="userEmailDisplay">admin@allitrack.com
                            </div>
                        </div>
                        <div class="account" id="accountBtn" aria-haspopup="true" aria-expanded="false">
                            <div class="avatar admin-avatar" id="userAvatar">AD</div>
                            <i class="fas fa-chevron-down" style="opacity:.85"></i>
                        </div>
                        <div class="account-menu" id="accountMenu">
                            <div class="arrow"></div>
                            <a href="../pages/profile-settings.html" data-translate="profile">Profile</a>
                            <a href="../pages/preferences.html" data-translate="settings">Settings</a>
                            <a href="../pages/audit-log.html" data-translate="audit_log">Audit Log</a>
                            <div class="divider"></div>
                            <a href="#" id="logoutBtn" data-translate="logout">Logout</a>
                        </div>
                    </div>
                </header>

                <!-- Dashboard Content -->
                <div class="content">
                    <div class="dashboard-content">
                        <!-- Feature 1: System Overview -->
                        <section class="dashboard-section">
                            <h2><i class="fas fa-tachometer-alt"></i> <span data-translate="system_overview">System
                                    Overview</span></h2>
                            <div class="system-overview-grid">
                                <div class="overview-card">
                                    <div class="overview-icon total-tickets">
                                        <i class="fas fa-ticket-alt"></i>
                                    </div>
                                    <div class="overview-content">
                                        <div class="overview-count">156</div>
                                        <div class="overview-label" data-translate="total_tickets">Total Tickets</div>
                                        <div class="overview-trend up">
                                            <i class="fas fa-arrow-up"></i> 12% <span
                                                data-translate="from_last_week">from last week</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="overview-card">
                                    <div class="overview-icon open-tickets">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="overview-content">
                                        <div class="overview-count">42</div>
                                        <div class="overview-label" data-translate="open_tickets">Open Tickets</div>
                                        <div class="overview-trend down">
                                            <i class="fas fa-arrow-down"></i> 8% <span
                                                data-translate="from_yesterday">from yesterday</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="overview-card">
                                    <div class="overview-icon avg-response">
                                        <i class="fas fa-stopwatch"></i>
                                    </div>
                                    <div class="overview-content">
                                        <div class="overview-count">2.4<span class="unit">h</span></div>
                                        <div class="overview-label" data-translate="avg_response_time">Avg Response Time
                                        </div>
                                        <div class="overview-trend down">
                                            <i class="fas fa-arrow-down"></i> 15% <span
                                                data-translate="improvement">improvement</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Feature 2: Quick Stats & Actions -->
                        <div class="dashboard-row">
                            <section class="dashboard-section stats-section">
                                <h2><i class="fas fa-chart-pie"></i> <span data-translate="ticket_statistics">Ticket
                                        Statistics</span></h2>
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-value">65%</div>
                                        <div class="stat-label" data-translate="resolved_tickets">Resolved Tickets</div>
                                        <div class="stat-bar">
                                            <div class="stat-progress" style="width: 65%; background: #10B981;"></div>
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">23%</div>
                                        <div class="stat-label" data-translate="in_progress_tickets">In Progress</div>
                                        <div class="stat-bar">
                                            <div class="stat-progress" style="width: 23%; background: #F59E0B;"></div>
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">12%</div>
                                        <div class="stat-label" data-translate="new_tickets">New Tickets</div>
                                        <div class="stat-bar">
                                            <div class="stat-progress" style="width: 12%; background: #3B82F6;"></div>
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">8%</div>
                                        <div class="stat-label" data-translate="escalated_tickets">Escalated</div>
                                        <div class="stat-bar">
                                            <div class="stat-progress" style="width: 8%; background: #EF4444;"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section class="dashboard-section quick-actions-section">
                                <h2><i class="fas fa-bolt"></i> <span data-translate="admin_actions">Admin
                                        Actions</span></h2>
                                <div class="admin-actions-grid">
                                    <a href="../pages/users.html" class="admin-action-card">
                                        <div class="admin-action-icon">
                                            <i class="fas fa-user-plus"></i>
                                        </div>
                                        <div class="admin-action-content">
                                            <div class="admin-action-title" data-translate="add_user">Add User</div>
                                            <div class="admin-action-desc" data-translate="create_new_user_account">
                                                Create new user account</div>
                                        </div>
                                    </a>
                                    <a href="../pages/system-settings.html" class="admin-action-card">
                                        <div class="admin-action-icon">
                                            <i class="fas fa-cog"></i>
                                        </div>
                                        <div class="admin-action-content">
                                            <div class="admin-action-title" data-translate="system_config">System Config
                                            </div>
                                            <div class="admin-action-desc" data-translate="configure_system_settings">
                                                Configure system settings</div>
                                        </div>
                                    </a>
                                    <a href="../pages/reports.html" class="admin-action-card">
                                        <div class="admin-action-icon">
                                            <i class="fas fa-file-export"></i>
                                        </div>
                                        <div class="admin-action-content">
                                            <div class="admin-action-title" data-translate="generate_report">Generate
                                                Report</div>
                                            <div class="admin-action-desc" data-translate="create_performance_report">
                                                Create performance report</div>
                                        </div>
                                    </a>
                                    <a href="../pages/announcements-admin.html" class="admin-action-card">
                                        <div class="admin-action-icon">
                                            <i class="fas fa-bullhorn"></i>
                                        </div>
                                        <div class="admin-action-content">
                                            <div class="admin-action-title" data-translate="post_announcement">Post
                                                Announcement</div>
                                            <div class="admin-action-desc" data-translate="broadcast_to_all_users">
                                                Broadcast to all users</div>
                                        </div>
                                    </a>
                                </div>
                            </section>
                        </div>

                        <!-- Feature 3: Recent Activity & Alerts -->
                        <div class="dashboard-row">
                            <section class="dashboard-section activity-section">
                                <h2><i class="fas fa-history"></i> <span data-translate="recent_system_activity">Recent
                                        System Activity</span></h2>
                                <div class="system-activity-list">
                                    <div class="system-activity-item">
                                        <div class="activity-type admin">
                                            <i class="fas fa-user-shield"></i>
                                        </div>
                                        <div class="activity-details">
                                            <div class="activity-title" data-translate="new_admin_added">New admin added
                                            </div>
                                            <div class="activity-meta" data-translate="user_jdoe_added_as_admin">User
                                                jdoe added as system administrator</div>
                                        </div>
                                        <div class="activity-time">10 min ago</div>
                                    </div>
                                    <div class="system-activity-item">
                                        <div class="activity-type ticket">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <div class="activity-details">
                                            <div class="activity-title" data-translate="ticket_escalated">Ticket
                                                escalated</div>
                                            <div class="activity-meta" data-translate="ticket_4872_escalated">Ticket
                                                #TKT-4872 escalated to Level 2</div>
                                        </div>
                                        <div class="activity-time">45 min ago</div>
                                    </div>
                                    <div class="system-activity-item">
                                        <div class="activity-type system">
                                            <i class="fas fa-server"></i>
                                        </div>
                                        <div class="activity-details">
                                            <div class="activity-title" data-translate="system_backup_completed">System
                                                backup completed</div>
                                            <div class="activity-meta" data-translate="daily_backup_successful">Daily
                                                backup completed successfully</div>
                                        </div>
                                        <div class="activity-time">2 hours ago</div>
                                    </div>
                                    <div class="system-activity-item">
                                        <div class="activity-type user">
                                            <i class="fas fa-user-slash"></i>
                                        </div>
                                        <div class="activity-details">
                                            <div class="activity-title" data-translate="user_deactivated">User
                                                deactivated</div>
                                            <div class="activity-meta" data-translate="user_inactive_account">User
                                                account deactivated due to inactivity</div>
                                        </div>
                                        <div class="activity-time">5 hours ago</div>
                                    </div>
                                </div>
                            </section>

                            <section class="dashboard-section alerts-section">
                                <h2><i class="fas fa-bell"></i> <span data-translate="system_alerts">System
                                        Alerts</span></h2>
                                <div class="alerts-list">
                                    <div class="alert-item warning">
                                        <div class="alert-icon">
                                            <i class="fas fa-exclamation-circle"></i>
                                        </div>
                                        <div class="alert-content">
                                            <div class="alert-title" data-translate="high_ticket_volume">High Ticket
                                                Volume</div>
                                            <div class="alert-desc" data-translate="tickets_exceeding_threshold">Ticket
                                                submissions exceeding threshold</div>
                                        </div>
                                        <a href="../pages/admin-tickets.html" class="alert-action"
                                            data-translate="view">View</a>
                                    </div>
                                    <div class="alert-item info">
                                        <div class="alert-icon">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <div class="alert-content">
                                            <div class="alert-title" data-translate="update_available">Update Available
                                            </div>
                                            <div class="alert-desc" data-translate="system_update_v1_3_0">System update
                                                v1.3.0 available</div>
                                        </div>
                                        <a href="../pages/system-settings.html" class="alert-action"
                                            data-translate="update">Update</a>
                                    </div>
                                    <div class="alert-item success">
                                        <div class="alert-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div class="alert-content">
                                            <div class="alert-title" data-translate="backup_successful">Backup
                                                Successful</div>
                                            <div class="alert-desc" data-translate="latest_backup_completed">Latest
                                                system backup completed</div>
                                        </div>
                                        <a href="../pages/system-settings.html" class="alert-action"
                                            data-translate="details">Details</a>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="site-footer">
                    <div>&copy; 2025 Business Alliance Inc.</div>
                    <div data-translate="admin_dashboard_template">Admin Dashboard Template</div>
                </footer>
            </main>
        </div>
    </div>

    <script>
        // Translation dictionary for admin dashboard page
        const translations = {
            'en': {
                // PAGE-SPECIFIC translations only:
                'dashboard_page_title': 'Admin Dashboard - AlliTrack',
                'admin_dashboard': 'Admin Dashboard',
                'dashboard': 'Dashboard',
                'ticket_management': 'Ticket Management',
                'all_tickets': 'All Tickets',
                'ticket_queue': 'Ticket Queue',
                'escalated_tickets': 'Escalated Tickets',
                'user_management': 'User Management',
                'users': 'Users',
                'support_agents': 'Support Agents',
                'roles_permissions': 'Roles & Permissions',
                'analytics': 'Analytics',
                'reports': 'Reports',
                'performance': 'Performance',
                'insights': 'Insights',
                'system_admin': 'System Admin',
                'system_settings': 'System Settings',
                'announcements': 'Announcements',
                'audit_log': 'Audit Log',
                'preferences': 'Preferences',
                'theme_preference': 'Theme Preference',
                'language_preference': 'Language Preference',
                'search_tickets': 'Search tickets, users, agents...',
                'admin': 'Admin',
                'profile': 'Profile',
                'settings': 'Settings',
                'logout': 'Logout',
                'system_overview': 'System Overview',
                'total_tickets': 'Total Tickets',
                'open_tickets': 'Open Tickets',
                'avg_response_time': 'Avg Response Time',
                'from_last_week': 'from last week',
                'from_yesterday': 'from yesterday',
                'improvement': 'improvement',
                'ticket_statistics': 'Ticket Statistics',
                'resolved_tickets': 'Resolved Tickets',
                'in_progress_tickets': 'In Progress',
                'new_tickets': 'New Tickets',
                'escalated_tickets': 'Escalated',
                'admin_actions': 'Admin Actions',
                'add_user': 'Add User',
                'create_new_user_account': 'Create new user account',
                'system_config': 'System Config',
                'configure_system_settings': 'Configure system settings',
                'generate_report': 'Generate Report',
                'create_performance_report': 'Create performance report',
                'post_announcement': 'Post Announcement',
                'broadcast_to_all_users': 'Broadcast to all users',
                'recent_system_activity': 'Recent System Activity',
                'new_admin_added': 'New admin added',
                'user_jdoe_added_as_admin': 'User jdoe added as system administrator',
                'ticket_escalated': 'Ticket escalated',
                'ticket_4872_escalated': 'Ticket #TKT-4872 escalated to Level 2',
                'system_backup_completed': 'System backup completed',
                'daily_backup_successful': 'Daily backup completed successfully',
                'user_deactivated': 'User deactivated',
                'user_inactive_account': 'User account deactivated due to inactivity',
                'system_alerts': 'System Alerts',
                'high_ticket_volume': 'High Ticket Volume',
                'tickets_exceeding_threshold': 'Ticket submissions exceeding threshold',
                'update_available': 'Update Available',
                'system_update_v1_3_0': 'System update v1.3.0 available',
                'backup_successful': 'Backup Successful',
                'latest_backup_completed': 'Latest system backup completed',
                'view': 'View',
                'update': 'Update',
                'details': 'Details',
                'admin_dashboard_template': 'Admin Dashboard Template'
            },
            'fil': {
                // PAGE-SPECIFIC translations only:
                'dashboard_page_title': 'Admin Dashboard - AlliTrack',
                'admin_dashboard': 'Admin Dashboard',
                'dashboard': 'Dashboard',
                'ticket_management': 'Pamamahala ng Ticket',
                'all_tickets': 'Lahat ng Ticket',
                'ticket_queue': 'Pila ng Ticket',
                'escalated_tickets': 'Na-escalate na Ticket',
                'user_management': 'Pamamahala ng User',
                'users': 'Mga User',
                'support_agents': 'Mga Support Agent',
                'roles_permissions': 'Mga Role at Permissions',
                'analytics': 'Analytics',
                'reports': 'Mga Report',
                'performance': 'Performance',
                'insights': 'Mga Insight',
                'system_admin': 'System Admin',
                'system_settings': 'Mga Setting ng System',
                'announcements': 'Mga Anunsyo',
                'audit_log': 'Audit Log',
                'preferences': 'Mga Kagustuhan',
                'theme_preference': 'Kagustuhan sa Tema',
                'language_preference': 'Kagustuhan sa Wika',
                'search_tickets': 'Maghanap ng mga ticket, user, agent...',
                'admin': 'Admin',
                'profile': 'Profile',
                'settings': 'Mga Setting',
                'logout': 'Mag-logout',
                'system_overview': 'Pangkalahatang-ideya ng System',
                'total_tickets': 'Kabuuang mga Ticket',
                'open_tickets': 'Mga Bukas na Ticket',
                'avg_response_time': 'Average na Response Time',
                'from_last_week': 'mula noong nakaraang linggo',
                'from_yesterday': 'mula kahapon',
                'improvement': 'pagpapabuti',
                'ticket_statistics': 'Mga Istatistika ng Ticket',
                'resolved_tickets': 'Mga Naresolbang Ticket',
                'in_progress_tickets': 'Kasulukuyang Ginagawa',
                'new_tickets': 'Mga Bagong Ticket',
                'escalated_tickets': 'Na-escalate',
                'admin_actions': 'Mga Admin Action',
                'add_user': 'Magdagdag ng User',
                'create_new_user_account': 'Gumawa ng bagong user account',
                'system_config': 'System Config',
                'configure_system_settings': 'I-configure ang mga system setting',
                'generate_report': 'Gumawa ng Report',
                'create_performance_report': 'Gumawa ng performance report',
                'post_announcement': 'Mag-post ng Anunsyo',
                'broadcast_to_all_users': 'I-broadcast sa lahat ng user',
                'recent_system_activity': 'Kamakailang System Activity',
                'new_admin_added': 'Bagong admin na idinagdag',
                'user_jdoe_added_as_admin': 'User jdoe idinagdag bilang system administrator',
                'ticket_escalated': 'Na-escalate ang ticket',
                'ticket_4872_escalated': 'Ticket #TKT-4872 na-escalate sa Level 2',
                'system_backup_completed': 'Natapos ang system backup',
                'daily_backup_successful': 'Matagumpay na natapos ang daily backup',
                'user_deactivated': 'Na-deactivate ang user',
                'user_inactive_account': 'Na-deactivate ang user account dahil sa inactivity',
                'system_alerts': 'Mga System Alert',
                'high_ticket_volume': 'Mataas na Volume ng Ticket',
                'tickets_exceeding_threshold': 'Lumalampas sa threshold ang mga submission ng ticket',
                'update_available': 'May Available na Update',
                'system_update_v1_3_0': 'System update v1.3.0 available',
                'backup_successful': 'Matagumpay ang Backup',
                'latest_backup_completed': 'Natapos na ang pinakabagong system backup',
                'view': 'Tingnan',
                'update': 'I-update',
                'details': 'Mga Detalye',
                'admin_dashboard_template': 'Admin Dashboard Template'
            }
        };

        // Check screen size on load and resize
        function checkScreenSize() {
            const mobileWarning = document.querySelector('.mobile-warning');
            const dashboardContent = document.querySelector('.app');

            if (window.innerWidth <= 768) {
                if (mobileWarning) mobileWarning.style.display = 'block';
                if (dashboardContent) dashboardContent.style.display = 'none';
            } else {
                if (mobileWarning) mobileWarning.style.display = 'none';
                if (dashboardContent) dashboardContent.style.display = 'flex';
            }
        }

        // Initialize the page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Admin Dashboard: Starting initialization...');

            // Check screen size
            checkScreenSize();

            // Load admin user data
            loadAndDisplayAdminData();

            // Initialize preferences manager
            if (window.preferencesManager) {
                console.log('Admin Dashboard: Initializing Preferences Manager...');
                window.preferencesManager.initialize();
                window.preferencesManager.applyTheme();

                const currentLang = window.preferencesManager.getCurrentLanguage() || 'en';
                applyTranslations(currentLang);
            } else {
                console.error('Admin Dashboard: preferencesManager not found!');
                applyTranslations('en');
            }

            // Setup theme listener
            setupThemeListener();

            // Setup logout functionality
            setupLogout();

            // Setup account dropdown
            setupAccountDropdown();

            console.log('Admin Dashboard page loaded');

            // Listen for storage events
            window.addEventListener('storage', function (e) {
                if (e.key === 'userData' || e.key === 'userProfile' || e.key === 'loggedInUser' || e.key === 'currentUser') {
                    console.log('User data changed in storage, reloading...');
                    loadAndDisplayAdminData();
                }
            });

            // Listen for resize events
            window.addEventListener('resize', checkScreenSize);
        });

        // Load admin user data
        function loadAndDisplayAdminData() {
            try {
                console.log('Looking for admin user data...');

                // First check for admin-specific data
                const adminData = localStorage.getItem('adminData');
                if (adminData) {
                    const parsedData = JSON.parse(adminData);
                    updateUserDisplay(parsedData);
                    return;
                }

                // Fallback to regular user data
                const possibleKeys = [
                    'userData',
                    'userProfile',
                    'loggedInUser',
                    'currentUser',
                    'user',
                    'loginData',
                    'authData'
                ];

                let userData = null;

                for (const key of possibleKeys) {
                    const storedData = localStorage.getItem(key);
                    if (storedData) {
                        try {
                            const parsedData = JSON.parse(storedData);
                            if (parsedData && (parsedData.name || parsedData.email || parsedData.username || parsedData.fullName)) {
                                userData = parsedData;
                                // Add admin flag
                                userData.isAdmin = true;
                                userData.role = 'Administrator';
                                break;
                            }
                        } catch (e) {
                            console.log(`Data in "${key}" is not valid JSON`);
                        }
                    }
                }

                if (userData) {
                    updateUserDisplay(userData);
                } else {
                    // Default admin user
                    updateUserDisplay({
                        name: 'Administrator',
                        email: 'admin@allitrack.com',
                        initials: 'AD',
                        isAdmin: true,
                        role: 'System Administrator'
                    });
                }

            } catch (error) {
                console.error('Error loading admin data:', error);
                updateUserDisplay({
                    name: 'Administrator',
                    email: 'admin@allitrack.com',
                    initials: 'AD',
                    isAdmin: true,
                    role: 'System Administrator'
                });
            }
        }

        // Update user display in header
        function updateUserDisplay(userData) {
            console.log('Updating admin display with:', userData);

            const userNameDisplay = document.getElementById('userNameDisplay');
            const userEmailDisplay = document.getElementById('userEmailDisplay');
            const userAvatar = document.getElementById('userAvatar');

            if (userNameDisplay && userData) {
                const name = userData.name ||
                    userData.fullName ||
                    userData.username ||
                    (userData.firstName && userData.lastName ? `${userData.firstName} ${userData.lastName}` : null) ||
                    userData.email?.split('@')[0] ||
                    'Administrator';

                userNameDisplay.textContent = name;
            }

            if (userEmailDisplay && userData) {
                const email = userData.email ||
                    userData.userEmail ||
                    userData.emailAddress ||
                    'admin@allitrack.com';

                userEmailDisplay.textContent = email;
            }

            if (userAvatar && userData) {
                let initials = 'AD';
                const nameForInitials = userData.name ||
                    userData.fullName ||
                    userData.username ||
                    (userData.firstName && userData.lastName ? `${userData.firstName} ${userData.lastName}` : null);

                if (nameForInitials) {
                    initials = nameForInitials
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .substring(0, 2);
                } else if (userData.email) {
                    initials = userData.email.substring(0, 2).toUpperCase();
                }

                userAvatar.textContent = initials;

                if (userData.photo || userData.profilePicture || userData.avatar) {
                    const photoUrl = userData.photo || userData.profilePicture || userData.avatar;
                    userAvatar.style.backgroundImage = `url('${photoUrl}')`;
                    userAvatar.style.backgroundSize = 'cover';
                    userAvatar.style.backgroundPosition = 'center';
                    userAvatar.textContent = '';
                }
            }
        }

        // Setup theme listener
        function setupThemeListener() {
            console.log('Setting up theme listener for admin dashboard...');

            window.addEventListener('storage', (event) => {
                if (event.key === 'preferredTheme') {
                    console.log('Theme changed via storage:', event.newValue);
                    if (window.preferencesManager) {
                        setTimeout(() => {
                            window.preferencesManager.applyTheme();
                        }, 100);
                    }
                }
            });

            document.addEventListener('themeChanged', function (e) {
                console.log('Theme changed via event:', e.detail.theme);
                if (window.preferencesManager) {
                    window.preferencesManager.applyTheme();
                }
            });
        }

        // Apply translations to the page
        function applyTranslations(language) {
            const lang = translations[language] ? language : 'en';
            const dict = translations[lang];

            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (dict[key]) {
                    element.textContent = dict[key];
                }
            });

            document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (dict[key]) {
                    element.placeholder = dict[key];
                }
            });

            if (dict['dashboard_page_title']) {
                document.title = dict['dashboard_page_title'];
            }
        }

        // Listen for language changes
        document.addEventListener('languageChanged', function (e) {
            console.log('Language changed to:', e.detail.language);
            applyTranslations(e.detail.language);
        });

        // Account Dropdown Functionality
        function setupAccountDropdown() {
            console.log('Setting up admin account dropdown...');
            const accountBtn = document.getElementById("accountBtn");
            const accountMenu = document.getElementById("accountMenu");

            if (accountBtn && accountMenu) {
                const newBtn = accountBtn.cloneNode(true);
                accountBtn.parentNode.replaceChild(newBtn, accountBtn);

                const refreshedBtn = document.getElementById("accountBtn");
                const refreshedMenu = document.getElementById("accountMenu");

                refreshedBtn.addEventListener("click", function (e) {
                    console.log('Admin account button clicked!');
                    e.stopPropagation();
                    e.preventDefault();

                    const isShowing = refreshedMenu.classList.contains("show");
                    refreshedMenu.classList.toggle("show");
                    refreshedBtn.setAttribute("aria-expanded", !isShowing);
                });

                document.addEventListener("click", function (e) {
                    if (!refreshedBtn.contains(e.target) && !refreshedMenu.contains(e.target)) {
                        refreshedMenu.classList.remove("show");
                        refreshedBtn.setAttribute("aria-expanded", false);
                    }
                });

                document.addEventListener("keydown", function (e) {
                    if (e.key === "Escape" && refreshedMenu.classList.contains("show")) {
                        refreshedMenu.classList.remove("show");
                        refreshedBtn.setAttribute("aria-expanded", false);
                    }
                });

                const menuItems = refreshedMenu.querySelectorAll("a");
                menuItems.forEach(item => {
                    item.addEventListener("click", function () {
                        refreshedMenu.classList.remove("show");
                        refreshedBtn.setAttribute("aria-expanded", false);
                    });
                });

                refreshedBtn.style.cursor = 'pointer';
                console.log('Admin account dropdown setup complete');
            } else {
                console.error('Admin account dropdown elements not found!');
            }
        }

        // Logout functionality
        function setupLogout() {
            const logoutBtn = document.getElementById("logoutBtn");
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function (e) {
                    e.preventDefault();

                    const keysToRemove = [
                        'userData',
                        'userProfile',
                        'loggedInUser',
                        'currentUser',
                        'user',
                        'loginData',
                        'authData',
                        'isLoggedIn',
                        'adminData'
                    ];

                    keysToRemove.forEach(key => {
                        localStorage.removeItem(key);
                    });

                    sessionStorage.clear();

                    window.location.href = '../../landing page/pages/index.html';
                });
            }
        }

        // Listen for user data changes
        document.addEventListener('userDataChanged', function (e) {
            console.log('User data changed event received:', e.detail);
            if (e.detail && e.detail.userData) {
                updateUserDisplay(e.detail.userData);
            }
        });
    </script>
</body>

</html>