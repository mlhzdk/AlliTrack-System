<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>System Settings - AlliTrack</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="../css/header-sidebar.css" />
    <link rel="stylesheet" href="../css/settings.css" />
</head>

<body>
    <div class="app">
        <div class="shell">
            <!-- Sidebar -->
            <aside class="sidebar" role="navigation" aria-label="Main Sidebar">
                <div class="brand">
                    <div class="logo">AT</div>
                    <div>
                        <div class="title">AlliTrack</div>
                        <div class="subtitle">Admin Dashboard</div>
                    </div>
                </div>
                <nav class="nav">
                    <a href="../pages/index-admin.html" data-section="dashboard">
                        <i class="fas fa-chart-line"></i> Dashboard
                    </a>
                    <div class="nav-section">Tickets</div>
                    <a href="../pages/tickets.html" data-section="tickets">
                        <i class="fas fa-ticket-alt"></i> All Tickets
                    </a>
                    <div class="nav-section">Management</div>
                    <a href="../pages/users-roles.html" data-section="users">
                        <i class="fas fa-users"></i> Users & Roles
                    </a>
                    <a href="../pages/reports.html" data-section="reports">
                        <i class="fas fa-file-alt"></i> Reports
                    </a>
                    <div class="nav-section">System</div>
                    <a href="#" data-section="integration">
                        <i class="fas fa-plug"></i> Integration
                    </a>
                    <a href="../pages/settings.html" class="active" data-section="settings">
                        <i class="fas fa-gear"></i> System Settings
                    </a>
                </nav>
                <div class="sidebar-footer">
                    <div class="version">v1.2.0</div>
                    <div>Business Alliance Inc.</div>
                </div>
            </aside>

            <!-- Main -->
            <main class="main">
                <!-- Header -->
                <header class="header">
                    <div class="search" role="search" aria-label="Search Settings">
                        <i class="fas fa-search" style="opacity:.6"></i>
                        <input id="searchInput" placeholder="Search settings, options, features..." aria-label="Search settings, options, features" />
                    </div>
                    <div class="header-actions">
                        <div style="text-align:right">
                            <!-- Dynamic user data will be inserted here -->
                            <div style="font-weight:700" id="userName">Admin User</div>
                            <div style="font-size:.82rem;color:var(--muted)" id="userEmail">Administrator</div>
                        </div>
                        <div class="account" id="accountBtn" aria-haspopup="true" aria-expanded="false">
                            <!-- Dynamic avatar initials -->
                            <div class="avatar" id="userAvatar">AJ</div>
                            <i class="fas fa-chevron-down" style="opacity:.85"></i>
                        </div>
                        <div class="account-menu" id="accountMenu">
                            <div class="arrow"></div>
                            <a href="../pages/settings.html">Settings</a>
                            <a href="#" id="logoutBtn">Logout</a>
                        </div>
                    </div>
                </header>

                <section class="content">
                    <!-- Settings Controls -->
                    <div class="settings-controls">
                        <div class="controls-left">
                            <h1 class="page-title">System Settings</h1>
                            <div class="settings-subtitle">Configure your AlliTrack system preferences</div>
                        </div>
                        <div class="controls-right">
                            <button class="btn-secondary" id="resetBtn">
                                <i class="fas fa-undo"></i> Reset to Defaults
                            </button>
                            <button class="btn-primary" id="saveBtn">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                    </div>

                    <!-- Settings Navigation -->
                    <div class="settings-nav">
                        <button class="nav-btn active" data-section="general">
                            <i class="fas fa-cog"></i> General
                        </button>
                        <button class="nav-btn" data-section="notifications">
                            <i class="fas fa-bell"></i> Notifications
                        </button>
                        <button class="nav-btn" data-section="tickets">
                            <i class="fas fa-ticket-alt"></i> Tickets
                        </button>
                        <button class="nav-btn" data-section="security">
                            <i class="fas fa-shield-alt"></i> Security
                        </button>
                        <button class="nav-btn" data-section="advanced">
                            <i class="fas fa-sliders-h"></i> Advanced
                        </button>
                    </div>

                    <!-- Settings Sections -->
                    <div class="settings-sections">
                        <!-- General Settings -->
                        <div class="settings-section active" id="general-section">
                            <div class="settings-grid">
                                <div class="setting-card" data-search="system name timezone date format">
                                    <div class="setting-header">
                                        <h3>System Information</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label for="systemName">System Name</label>
                                            <input type="text" id="systemName" class="form-input" placeholder="AlliTrack Support System">
                                        </div>
                                        <div class="form-group">
                                            <label for="timezone">Timezone</label>
                                            <select id="timezone" class="form-select">
                                                <option value="UTC-8">Pacific Time (UTC-8)</option>
                                                <option value="UTC-5" selected>Eastern Time (UTC-5)</option>
                                                <option value="UTC">UTC</option>
                                                <option value="UTC+1">Central European Time (UTC+1)</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="dateFormat">Date Format</label>
                                            <select id="dateFormat" class="form-select">
                                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notifications Settings -->
                        <div class="settings-section" id="notifications-section">
                            <div class="settings-grid">
                                <div class="setting-card" data-search="email notifications new tickets updates digest">
                                    <div class="setting-header">
                                        <h3>Email Notifications</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="emailNewTickets" checked>
                                                <span class="checkmark"></span>
                                                New ticket assignments
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="emailTicketUpdates" checked>
                                                <span class="checkmark"></span>
                                                Ticket status changes
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="emailDailyDigest">
                                                <span class="checkmark"></span>
                                                Daily digest report
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-card" data-search="push in-app notifications urgent system alerts">
                                    <div class="setting-header">
                                        <h3>In-App Notifications</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="pushNewTickets" checked>
                                                <span class="checkmark"></span>
                                                New tickets
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="pushUrgentTickets" checked>
                                                <span class="checkmark"></span>
                                                Urgent tickets only
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="pushSystemAlerts">
                                                <span class="checkmark"></span>
                                                System alerts
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tickets Settings -->
                        <div class="settings-section" id="tickets-section">
                            <div class="settings-grid">
                                <div class="setting-card" data-search="workflow auto assign sla response resolution time">
                                    <div class="setting-header">
                                        <h3>Workflow</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label for="autoAssign">Auto-assign tickets</label>
                                            <select id="autoAssign" class="form-select">
                                                <option value="disabled">Disabled</option>
                                                <option value="round-robin" selected>Round Robin</option>
                                                <option value="least-busy">Least Busy Agent</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="slaResponse">SLA Response Time (hours)</label>
                                            <input type="number" id="slaResponse" class="form-input" value="24" min="1" max="168">
                                        </div>
                                        <div class="form-group">
                                            <label for="slaResolution">SLA Resolution Time (hours)</label>
                                            <input type="number" id="slaResolution" class="form-input" value="72" min="1" max="720">
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-card" data-search="automation auto close escalate canned responses">
                                    <div class="setting-header">
                                        <h3>Automation</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="autoCloseResolved" checked>
                                                <span class="checkmark"></span>
                                                Auto-close resolved tickets after 7 days
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="autoEscalate">
                                                <span class="checkmark"></span>
                                                Auto-escalate overdue tickets
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="cannedResponses" checked>
                                                <span class="checkmark"></span>
                                                Enable canned responses
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Security Settings -->
                        <div class="settings-section" id="security-section">
                            <div class="settings-grid">
                                <div class="setting-card" data-search="authentication session timeout two factor password policy">
                                    <div class="setting-header">
                                        <h3>Authentication</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label for="sessionTimeout">Session Timeout (minutes)</label>
                                            <input type="number" id="sessionTimeout" class="form-input" value="60" min="5" max="1440">
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="twoFactorAuth">
                                                <span class="checkmark"></span>
                                                Require two-factor authentication
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="passwordPolicy" checked>
                                                <span class="checkmark"></span>
                                                Enforce password policy
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-card" data-search="access control ip whitelist api login attempts">
                                    <div class="setting-header">
                                        <h3>Access Control</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="ipWhitelist">
                                                <span class="checkmark"></span>
                                                Enable IP whitelisting
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="apiAccess" checked>
                                                <span class="checkmark"></span>
                                                Enable API access
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label for="maxLoginAttempts">Max Login Attempts</label>
                                            <input type="number" id="maxLoginAttempts" class="form-input" value="5" min="1" max="10">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Settings -->
                        <div class="settings-section" id="advanced-section">
                            <div class="settings-grid">
                                <div class="setting-card" data-search="system maintenance backup frequency updates error reporting">
                                    <div class="setting-header">
                                        <h3>System Maintenance</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label for="backupFrequency">Backup Frequency</label>
                                            <select id="backupFrequency" class="form-select">
                                                <option value="daily">Daily</option>
                                                <option value="weekly" selected>Weekly</option>
                                                <option value="monthly">Monthly</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="autoUpdates" checked>
                                                <span class="checkmark"></span>
                                                Automatic system updates
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="errorReporting">
                                                <span class="checkmark"></span>
                                                Send error reports
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-card" data-search="performance cache duration query optimization compression">
                                    <div class="setting-header">
                                        <h3>Performance</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="form-group">
                                            <label for="cacheDuration">Cache Duration (minutes)</label>
                                            <input type="number" id="cacheDuration" class="form-input" value="30" min="1" max="1440">
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="queryOptimization" checked>
                                                <span class="checkmark"></span>
                                                Enable query optimization
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="compression">
                                                <span class="checkmark"></span>
                                                Enable response compression
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="setting-card danger-zone" data-search="danger zone clear cache reset system export data">
                                    <div class="setting-header">
                                        <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                                    </div>
                                    <div class="setting-body">
                                        <div class="danger-actions">
                                            <button class="btn-danger" id="clearCacheBtn">
                                                <i class="fas fa-broom"></i> Clear System Cache
                                            </button>
                                            <button class="btn-danger" id="resetSystemBtn">
                                                <i class="fas fa-trash"></i> Reset System Data
                                            </button>
                                            <button class="btn-danger" id="exportSystemBtn">
                                                <i class="fas fa-download"></i> Export System Data
                                            </button>
                                        </div>
                                        <div class="danger-warning">
                                            <i class="fas fa-exclamation-circle"></i>
                                            These actions are irreversible and may affect system performance.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Footer -->
                <footer class="site-footer">
                    <div>&copy; 2025 Business Alliance Inc.</div>
                    <div>Dashboard Template</div>
                </footer>
            </main>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Are you sure you want to proceed with this action?</p>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="cancelConfirm">Cancel</button>
                <button class="btn-primary" id="proceedConfirm">Proceed</button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="toast">
        <div class="toast-content">
            <i class="fas fa-check-circle"></i>
            <span>Settings saved successfully!</span>
        </div>
    </div>

    <script>
        // Load and display user data from localStorage - EXACTLY as in index-admin.html
        function loadUserData() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            
            if (userData) {
                // Display user name
                const userNameElement = document.getElementById('userName');
                if (userNameElement && userData.name) {
                    userNameElement.textContent = userData.name;
                }
                
                // Display user email
                const userEmailElement = document.getElementById('userEmail');
                if (userEmailElement && userData.email) {
                    userEmailElement.textContent = userData.email;
                }
                
                // Display avatar initials
                const userAvatarElement = document.getElementById('userAvatar');
                if (userAvatarElement && userData.name) {
                    // Get initials from name
                    const nameParts = userData.name.split(' ');
                    let initials = '';
                    
                    if (nameParts.length >= 2) {
                        initials = nameParts[0].charAt(0) + nameParts[1].charAt(0);
                    } else if (nameParts.length === 1) {
                        initials = nameParts[0].charAt(0);
                        if (nameParts[0].length > 1) {
                            initials += nameParts[0].charAt(1);
                        }
                    }
                    
                    userAvatarElement.textContent = initials.toUpperCase();
                }
            } else {
                // If no user data, redirect to login page
                window.location.href = '../../landing page/pages/index.html';
            }
        }
        
        // Call the function when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            initializeSettingsPage();
        });

        // Dropdown toggle - EXACTLY as in index-admin.html
        const accountBtn = document.getElementById("accountBtn");
        const accountMenu = document.getElementById("accountMenu");

        if (accountBtn && accountMenu) {
            accountBtn.addEventListener("click", () => {
                accountMenu.classList.toggle("show");
                accountBtn.setAttribute("aria-expanded", accountMenu.classList.contains("show"));
            });

            window.addEventListener("click", (e) => {
                if (!accountBtn.contains(e.target) && !accountMenu.contains(e.target)) {
                    accountMenu.classList.remove("show");
                    accountBtn.setAttribute("aria-expanded", false);
                }
            });
        }

        // Logout functionality - EXACTLY as in index-admin.html
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function (e) {
                e.preventDefault();

                // Clear user data from localStorage
                localStorage.removeItem('userData');

                // Redirect to login page
                window.location.href = '../../landing page/pages/index.html';
            });
        }

        // Default settings configuration
        const defaultSettings = {
            general: {
                systemName: "AlliTrack Support System",
                timezone: "UTC-5",
                dateFormat: "MM/DD/YYYY"
            },
            notifications: {
                emailNewTickets: true,
                emailTicketUpdates: true,
                emailDailyDigest: false,
                pushNewTickets: true,
                pushUrgentTickets: true,
                pushSystemAlerts: false
            },
            tickets: {
                autoAssign: "round-robin",
                slaResponse: 24,
                slaResolution: 72,
                autoCloseResolved: true,
                autoEscalate: false,
                cannedResponses: true
            },
            security: {
                sessionTimeout: 60,
                twoFactorAuth: false,
                passwordPolicy: true,
                ipWhitelist: false,
                apiAccess: true,
                maxLoginAttempts: 5
            },
            advanced: {
                backupFrequency: "weekly",
                autoUpdates: true,
                errorReporting: false,
                cacheDuration: 30,
                queryOptimization: true,
                compression: false
            }
        };

        // Current settings (initially set to defaults)
        let currentSettings = JSON.parse(JSON.stringify(defaultSettings));

        // DOM Elements for settings
        const settingsNav = document.querySelectorAll('.nav-btn');
        const settingsSections = document.querySelectorAll('.settings-section');
        const saveBtn = document.getElementById('saveBtn');
        const resetBtn = document.getElementById('resetBtn');
        const searchInput = document.getElementById('searchInput');
        const searchResultsInfo = document.getElementById('searchResultsInfo');
        const confirmModal = document.getElementById('confirmModal');
        const confirmMessage = document.getElementById('confirmMessage');
        const cancelConfirm = document.getElementById('cancelConfirm');
        const proceedConfirm = document.getElementById('proceedConfirm');
        const successToast = document.getElementById('successToast');
        const dangerButtons = document.querySelectorAll('.btn-danger');
        const settingCards = document.querySelectorAll('.setting-card');

        function initializeSettingsPage() {
            loadSettings();
            setupSettingsEventListeners();
            initializeSettingsForm();
        }

        // Set up event listeners for settings functionality
        function setupSettingsEventListeners() {
            // Navigation
            settingsNav.forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });

            // Save and reset buttons
            if (saveBtn) saveBtn.addEventListener('click', saveSettings);
            if (resetBtn) resetBtn.addEventListener('click', resetSettings);

            // Search functionality
            if (searchInput) {
                searchInput.addEventListener('input', handleSearch);
            }

            // Modal functionality
            if (cancelConfirm) cancelConfirm.addEventListener('click', closeConfirmModal);
            if (proceedConfirm) proceedConfirm.addEventListener('click', handleConfirmAction);

            // Danger zone buttons
            if (dangerButtons) {
                dangerButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const action = this.id;
                        showConfirmModal(action);
                    });
                });
            }

            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === confirmModal) {
                    closeConfirmModal();
                }
            });
        }

        // Load settings from localStorage or use defaults
        function loadSettings() {
            const savedSettings = localStorage.getItem('allitrackSettings');
            if (savedSettings) {
                currentSettings = JSON.parse(savedSettings);
            }
        }

        // Initialize form with current settings
        function initializeSettingsForm() {
            // General settings
            document.getElementById('systemName').value = currentSettings.general.systemName;
            document.getElementById('timezone').value = currentSettings.general.timezone;
            document.getElementById('dateFormat').value = currentSettings.general.dateFormat;

            // Notification settings
            document.getElementById('emailNewTickets').checked = currentSettings.notifications.emailNewTickets;
            document.getElementById('emailTicketUpdates').checked = currentSettings.notifications.emailTicketUpdates;
            document.getElementById('emailDailyDigest').checked = currentSettings.notifications.emailDailyDigest;
            document.getElementById('pushNewTickets').checked = currentSettings.notifications.pushNewTickets;
            document.getElementById('pushUrgentTickets').checked = currentSettings.notifications.pushUrgentTickets;
            document.getElementById('pushSystemAlerts').checked = currentSettings.notifications.pushSystemAlerts;

            // Ticket settings
            document.getElementById('autoAssign').value = currentSettings.tickets.autoAssign;
            document.getElementById('slaResponse').value = currentSettings.tickets.slaResponse;
            document.getElementById('slaResolution').value = currentSettings.tickets.slaResolution;
            document.getElementById('autoCloseResolved').checked = currentSettings.tickets.autoCloseResolved;
            document.getElementById('autoEscalate').checked = currentSettings.tickets.autoEscalate;
            document.getElementById('cannedResponses').checked = currentSettings.tickets.cannedResponses;

            // Security settings
            document.getElementById('sessionTimeout').value = currentSettings.security.sessionTimeout;
            document.getElementById('twoFactorAuth').checked = currentSettings.security.twoFactorAuth;
            document.getElementById('passwordPolicy').checked = currentSettings.security.passwordPolicy;
            document.getElementById('ipWhitelist').checked = currentSettings.security.ipWhitelist;
            document.getElementById('apiAccess').checked = currentSettings.security.apiAccess;
            document.getElementById('maxLoginAttempts').value = currentSettings.security.maxLoginAttempts;

            // Advanced settings
            document.getElementById('backupFrequency').value = currentSettings.advanced.backupFrequency;
            document.getElementById('autoUpdates').checked = currentSettings.advanced.autoUpdates;
            document.getElementById('errorReporting').checked = currentSettings.advanced.errorReporting;
            document.getElementById('cacheDuration').value = currentSettings.advanced.cacheDuration;
            document.getElementById('queryOptimization').checked = currentSettings.advanced.queryOptimization;
            document.getElementById('compression').checked = currentSettings.advanced.compression;
        }

        // Switch between settings sections
        function switchSection(section) {
            // Update navigation
            settingsNav.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // Update sections
            settingsSections.forEach(sec => sec.classList.remove('active'));
            document.getElementById(`${section}-section`).classList.add('active');
        }

        // Handle search functionality
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            let visibleCards = 0;
            let totalCards = 0;
            
            // Reset all cards to visible first
            settingCards.forEach(card => {
                card.style.display = 'block';
                totalCards++;
            });
            
            if (searchTerm === '') {
                if (searchResultsInfo) {
                    searchResultsInfo.textContent = 'All settings visible';
                }
                return;
            }

            // Search through settings cards
            settingCards.forEach(card => {
                const searchData = card.getAttribute('data-search') || '';
                const cardText = card.textContent.toLowerCase();
                const headerText = card.querySelector('.setting-header h3').textContent.toLowerCase();
                
                // Check if search term matches any searchable content
                if (searchData.includes(searchTerm) || 
                    cardText.includes(searchTerm) || 
                    headerText.includes(searchTerm)) {
                    card.style.display = 'block';
                    visibleCards++;
                    
                    // Highlight matching text
                    highlightText(card, searchTerm);
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Update search results info
            if (searchResultsInfo) {
                if (visibleCards === 0) {
                    searchResultsInfo.textContent = 'No settings found';
                } else {
                    searchResultsInfo.textContent = `Found ${visibleCards} of ${totalCards} settings`;
                }
            }
        }

        // Highlight matching text in settings cards
        function highlightText(element, searchTerm) {
            const walker = document.createTreeWalker(
                element,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );

            let node;
            const nodes = [];
            while (node = walker.nextNode()) {
                nodes.push(node);
            }

            nodes.forEach(node => {
                const text = node.nodeValue;
                const regex = new RegExp(`(${searchTerm})`, 'gi');
                const newText = text.replace(regex, '<mark class="search-highlight">$1</mark>');
                
                if (newText !== text) {
                    const span = document.createElement('span');
                    span.innerHTML = newText;
                    node.parentNode.replaceChild(span, node);
                }
            });
        }

        // Save settings
        function saveSettings() {
            // Update current settings from form
            updateSettingsFromForm();
            
            // Save to localStorage
            localStorage.setItem('allitrackSettings', JSON.stringify(currentSettings));
            
            // Show success message
            showToast('Settings saved successfully!');
            
            // In a real application, you would also send to server
            console.log('Settings saved:', currentSettings);
        }

        // Update settings from form values
        function updateSettingsFromForm() {
            // General settings
            currentSettings.general.systemName = document.getElementById('systemName').value;
            currentSettings.general.timezone = document.getElementById('timezone').value;
            currentSettings.general.dateFormat = document.getElementById('dateFormat').value;

            // Notification settings
            currentSettings.notifications.emailNewTickets = document.getElementById('emailNewTickets').checked;
            currentSettings.notifications.emailTicketUpdates = document.getElementById('emailTicketUpdates').checked;
            currentSettings.notifications.emailDailyDigest = document.getElementById('emailDailyDigest').checked;
            currentSettings.notifications.pushNewTickets = document.getElementById('pushNewTickets').checked;
            currentSettings.notifications.pushUrgentTickets = document.getElementById('pushUrgentTickets').checked;
            currentSettings.notifications.pushSystemAlerts = document.getElementById('pushSystemAlerts').checked;

            // Ticket settings
            currentSettings.tickets.autoAssign = document.getElementById('autoAssign').value;
            currentSettings.tickets.slaResponse = parseInt(document.getElementById('slaResponse').value);
            currentSettings.tickets.slaResolution = parseInt(document.getElementById('slaResolution').value);
            currentSettings.tickets.autoCloseResolved = document.getElementById('autoCloseResolved').checked;
            currentSettings.tickets.autoEscalate = document.getElementById('autoEscalate').checked;
            currentSettings.tickets.cannedResponses = document.getElementById('cannedResponses').checked;

            // Security settings
            currentSettings.security.sessionTimeout = parseInt(document.getElementById('sessionTimeout').value);
            currentSettings.security.twoFactorAuth = document.getElementById('twoFactorAuth').checked;
            currentSettings.security.passwordPolicy = document.getElementById('passwordPolicy').checked;
            currentSettings.security.ipWhitelist = document.getElementById('ipWhitelist').checked;
            currentSettings.security.apiAccess = document.getElementById('apiAccess').checked;
            currentSettings.security.maxLoginAttempts = parseInt(document.getElementById('maxLoginAttempts').value);

            // Advanced settings
            currentSettings.advanced.backupFrequency = document.getElementById('backupFrequency').value;
            currentSettings.advanced.autoUpdates = document.getElementById('autoUpdates').checked;
            currentSettings.advanced.errorReporting = document.getElementById('errorReporting').checked;
            currentSettings.advanced.cacheDuration = parseInt(document.getElementById('cacheDuration').value);
            currentSettings.advanced.queryOptimization = document.getElementById('queryOptimization').checked;
            currentSettings.advanced.compression = document.getElementById('compression').checked;
        }

        // Reset settings to defaults
        function resetSettings() {
            currentSettings = JSON.parse(JSON.stringify(defaultSettings));
            initializeSettingsForm();
            showToast('Settings reset to defaults!');
        }

        // Show confirmation modal for dangerous actions
        function showConfirmModal(action) {
            let message = '';
            
            switch(action) {
                case 'clearCacheBtn':
                    message = 'Are you sure you want to clear the system cache? This may temporarily affect performance.';
                    break;
                case 'resetSystemBtn':
                    message = 'Are you sure you want to reset all system data? This action cannot be undone!';
                    break;
                case 'exportSystemBtn':
                    message = 'Are you sure you want to export all system data? This may take several minutes.';
                    break;
            }
            
            if (confirmMessage) confirmMessage.textContent = message;
            if (proceedConfirm) proceedConfirm.setAttribute('data-action', action);
            if (confirmModal) confirmModal.style.display = 'block';
        }

        // Handle confirmed action
        function handleConfirmAction() {
            const action = proceedConfirm.getAttribute('data-action');
            
            switch(action) {
                case 'clearCacheBtn':
                    // Clear cache logic
                    showToast('System cache cleared successfully!');
                    break;
                case 'resetSystemBtn':
                    // Reset system logic
                    showToast('System data reset completed!');
                    break;
                case 'exportSystemBtn':
                    // Export system logic
                    showToast('System data export started!');
                    break;
            }
            
            closeConfirmModal();
        }

        // Close confirmation modal
        function closeConfirmModal() {
            if (confirmModal) confirmModal.style.display = 'none';
        }

        // Show success toast
        function showToast(message) {
            const toast = successToast.querySelector('span');
            toast.textContent = message;
            successToast.classList.add('show');
            
            setTimeout(() => {
                successToast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>